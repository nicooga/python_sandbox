<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Mojifinder</title>
    <style>
        body {
            font-family: "Lucida Sans Unicode", "Lucida Grande", sans-serif;
        }

        table {
            font-family: "Lucida Console", "Monaco", monospace;
            text-align: left;
            min-width: 300px        }

        td.code {
            min-width: 40px;
            text-align: right;
        }

        td.char {
            min-width: 50px;
            text-align: center;
        }

        caption {
            background: lightgray;
        }
    </style>
    <script>
        "use strict";

        function appendCell(row, text, class_) {
            const cell = document.createElement('td');

            cell.appendChild(document.createTextNode(text));

            if (class_ !== undefined) {
                cell.setAttribute('class', class_);
            }

            row.appendChild(cell);
        }

        function fillTable(results) {
            const table = document.querySelector('table');

            table.querySelectorAll('tr').forEach(row => row.remove());

            results.forEach((item) => {
                const row = document.createElement('tr');
                const code = item.char.codePointAt(0);
                const uCode = 'U+' + code.toString(16).toUpperCase().padStart(4, '0');
                appendCell(row, uCode, 'code');
                appendCell(row, item.char, 'char');
                appendCell(row, item.name);
                table.appendChild(row);
            });

            const plural = "s";
            const count = results.length;
            if (count === 1) plural = "";
            const msg = `${count} character${plural} found`;

            document.querySelector('caption').textContent = msg;
        }

        async function fetchResults(query) {
            const url = location.href.replace(location.search, '');
            const response = await fetch(`${url}search?q=${query}`);
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            return response.json();
        }

        async function updateTable() {
            const input = document.getElementById('query');

            try {
                const results = await fetchResults(input.value);
                fillTable(results);
            } catch (error) {
                console.error(error)
            }
        }

        window.addEventListener('DOMContentLoaded', (event) => {
            const input = document.getElementById('query');
            input.addEventListener('change', updateTable);
        });
    </script>

</head>

<body>
    <div>
        <input id="query" type="search" name="q" value="">
        <button onClick="updateTable()">Search</button>
    </div>
    <table>
        <caption></caption>
    </table>
</body>

</html>